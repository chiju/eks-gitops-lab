apiVersion: batch/v1
kind: Job
metadata:
  name: test-scale-load
  namespace: default
spec:
  parallelism: 10
  completions: 10
  backoffLimit: 0
  ttlSecondsAfterFinished: 300
  template:
    metadata:
      labels:
        app: test-scale
    spec:
      restartPolicy: Never
      containers:
      - name: stress
        image: polinux/stress
        command: ["stress"]
        args: ["--cpu", "1", "--vm", "1", "--vm-bytes", "50M", "--timeout", "120s"]
        resources:
          requests:
            cpu: 200m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 256Mi
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-scale-info
  namespace: default
data:
  README.md: |
    # Scale Test
    
    This Job creates 10 pods with CPU/memory load for 2 minutes.
    
    Timeline:
    1. Job starts → 10 pods created
    2. Pods pending → Karpenter provisions Spot nodes
    3. Pods run for 2 minutes with high CPU
    4. Job completes → Pods terminate
    5. After 5 minutes → Job auto-deleted (ttlSecondsAfterFinished)
    6. Karpenter consolidates → Removes unused nodes
    
    Watch: ./test-scale.sh
